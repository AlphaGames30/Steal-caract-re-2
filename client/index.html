<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Steal-a-Thing 3D Jouable + PNJ</title>
<style>
  body { margin: 0; overflow: hidden; }
</style>
</head>
<body>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.module.js';

// --- Scène ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xa0a0a0);

// --- Caméra ---
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 200);
camera.position.set(0, 10, 20);

// --- Renderer ---
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// --- Lumières ---
const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
scene.add(ambientLight);
const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
dirLight.position.set(10, 30, 10);
scene.add(dirLight);

// --- Sol vert ---
const solGeo = new THREE.PlaneGeometry(60, 40);
const solMat = new THREE.MeshStandardMaterial({ color: 0x228B22 });
const sol = new THREE.Mesh(solGeo, solMat);
sol.rotation.x = -Math.PI/2;
scene.add(sol);

// --- Tapis central ---
const tapisGeo = new THREE.PlaneGeometry(40, 30);
const tapisMat = new THREE.MeshStandardMaterial({ color: 0x7CFC00 });
const tapis = new THREE.Mesh(tapisGeo, tapisMat);
tapis.position.y = 0.01;
tapis.rotation.x = -Math.PI/2;
scene.add(tapis);

// --- Murs sur tous les côtés ---
function createWall(x,y,z,w,h,d,color){
  const geo = new THREE.BoxGeometry(w,h,d);
  const mat = new THREE.MeshStandardMaterial({ color });
  const mesh = new THREE.Mesh(geo,mat);
  mesh.position.set(x,y,z);
  scene.add(mesh);
}

const wallHeight = [1,1,0.2];
const wallColors = [0x808080,0x8B4513,0x228B22];
const halfWidth = 60/2;
const halfDepth = 40/2;
for(let i=0;i<3;i++){
  const y = wallHeight[i]/2 + (i>0 ? wallHeight[i-1]:0);
  // murs X
  createWall(0,y,-halfDepth,60,wallHeight[i],0.5,wallColors[i]);
  createWall(0,y,halfDepth,60,wallHeight[i],0.5,wallColors[i]);
  // murs Z
  createWall(-halfWidth,y,0,0.5,wallHeight[i],40,wallColors[i]);
  createWall(halfWidth,y,0,0.5,wallHeight[i],40,wallColors[i]);
}

// --- Bases ---
const BASES = 4;
const SLOTS = 6;
const baseWidth = 3;
const baseDepth = 2;
const slotSpacing = 1.2;

for(let b=0;b<BASES;b++){
  for(let s=0;s<SLOTS;s++){
    // gauche
    const slotGeo = new THREE.BoxGeometry(baseWidth,1,baseDepth);
    const slotMat = new THREE.MeshStandardMaterial({ color:0xaaaaaa });
    const slot = new THREE.Mesh(slotGeo,slotMat);
    slot.position.set(-25 + b*(baseWidth+1),0.5,-7 + s*(baseDepth+slotSpacing));
    scene.add(slot);
    // droite
    const slot2 = new THREE.Mesh(slotGeo,slotMat.clone());
    slot2.position.set(25 - b*(baseWidth+1),0.5,-7 + s*(baseDepth+slotSpacing));
    scene.add(slot2);
  }
}

// --- Personnage contrôlable ---
const playerGeo = new THREE.BoxGeometry(1,2,1);
const playerMat = new THREE.MeshStandardMaterial({ color:0x0000ff });
const player = new THREE.Mesh(playerGeo,playerMat);
player.position.set(0,1,12);
scene.add(player);

// --- Portails ---
const portalNorthGeo = new THREE.BoxGeometry(6,3,0.5);
const portalSouthGeo = new THREE.BoxGeometry(6,3,0.5);
const portalMat = new THREE.MeshStandardMaterial({ color:0xff00ff, transparent:true, opacity:0.5 });
const portalNorth = new THREE.Mesh(portalNorthGeo,portalMat);
portalNorth.position.set(0,1.5,-15);
scene.add(portalNorth);

const portalSouth = new THREE.Mesh(portalSouthGeo,portalMat.clone());
portalSouth.position.set(0,1.5,15);
scene.add(portalSouth);

// --- PNJ ---
const pnjList = [];
const pnjColors = [0xff0000,0x00ff00,0xffff00];

function spawnPNJ(){
  const geo = new THREE.BoxGeometry(1,2,1);
  const mat = new THREE.MeshStandardMaterial({ color: pnjColors[Math.floor(Math.random()*pnjColors.length)] });
  const pnj = new THREE.Mesh(geo,mat);
  pnj.position.set(0,1,-15); // portail nord
  pnjList.push(pnj);
  scene.add(pnj);
}

// spawn un PNJ toutes les 2 secondes
setInterval(spawnPNJ,2000);

// --- Déplacements joueur ---
const keys = {};
document.addEventListener('keydown', e=>keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e=>keys[e.key.toLowerCase()] = false);
const speed = 0.2;

// --- Animation ---
function animate(){
  requestAnimationFrame(animate);

  // Déplacer joueur
  if(keys['w'] || keys['arrowup']) player.position.z -= speed;
  if(keys['s'] || keys['arrowdown']) player.position.z += speed;
  if(keys['a'] || keys['arrowleft']) player.position.x -= speed;
  if(keys['d'] || keys['arrowright']) player.position.x += speed;

  // Caméra derrière joueur
  camera.position.x = player.position.x;
  camera.position.z = player.position.z + 8;
  camera.position.y = player.position.y + 5;
  camera.lookAt(player.position);

  // Déplacer les PNJ vers le sud
  for(let i=pnjList.length-1;i>=0;i--){
    const pnj = pnjList[i];
    pnj.position.z += 0.05; // vitesse PNJ
    if(pnj.position.z > 15){ // portail sud
      scene.remove(pnj);
      pnjList.splice(i,1);
    }
  }

  renderer.render(scene,camera);
}

animate();

// --- Resize ---
window.addEventListener('resize',()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>

