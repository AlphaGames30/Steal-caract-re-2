<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Steal-a-Thing â€“ Playset 3D</title>
<style>
  body { margin:0; overflow:hidden; font-family:sans-serif; }
  #ui {
    position:absolute; top:10px; left:10px;
    background:rgba(0,0,0,0.4); padding:10px; border-radius:8px;
  }
  button {
    display:block; margin:5px 0; padding:5px 10px;
    background:#28a745; border:none; color:white; cursor:pointer;
    border-radius:4px;
  }
  button:hover { background:#218838; }
  #money {
    position:absolute; bottom:20px; right:20px;
    color:yellow; font-size:24px; font-weight:bold;
  }
  #message {
    position:absolute; top:20px; left:50%; transform:translateX(-50%);
    color:red; font-size:22px; font-weight:bold; display:none;
  }
</style>
</head>
<body>
<div id="ui">
  <button id="buy0">Acheter Petit Titan (50ðŸ’µ)</button>
  <button id="buy1">Acheter Souris Malicieuse (80ðŸ’µ)</button>
  <button id="buy2">Acheter Grand HÃ©ron (120ðŸ’µ)</button>
  <button id="buy3">Acheter Petit Dragon (500ðŸ’µ)</button>
</div>
<div id="message">Plus de place !</div>
<div id="money">ðŸ’µ 100</div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.module.js';

// === SCÃˆNE, RENDERER, CAMÃ‰RA ===
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xa0a0a0);
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 200);
camera.position.set(0,12,20);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// === LUMIÃˆRES ===
scene.add(new THREE.AmbientLight(0xffffff,0.6));
const dirLight = new THREE.DirectionalLight(0xffffff,0.8);
dirLight.position.set(10,30,10);
scene.add(dirLight);

// === SOL ===
const ground = new THREE.Mesh(
  new THREE.PlaneGeometry(60,40),
  new THREE.MeshStandardMaterial({color:0x228B22})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// === MURS ===
function addWall(x,z,rot){
  const wallBottom = new THREE.Mesh(new THREE.BoxGeometry(40,2,1), new THREE.MeshStandardMaterial({color:0x555555}));
  wallBottom.position.set(x,1,z);
  wallBottom.rotation.y = rot;
  scene.add(wallBottom);
  const wallMid = new THREE.Mesh(new THREE.BoxGeometry(40,2,1), new THREE.MeshStandardMaterial({color:0x8B4513}));
  wallMid.position.set(x,3,z);
  wallMid.rotation.y = rot;
  scene.add(wallMid);
  const wallTop = new THREE.Mesh(new THREE.BoxGeometry(40,0.3,1), new THREE.MeshStandardMaterial({color:0x00aa00}));
  wallTop.position.set(x,4.15,z);
  wallTop.rotation.y = rot;
  scene.add(wallTop);
}
addWall(0,20,0);
addWall(0,-20,0);
addWall(30,0,Math.PI/2);
addWall(-30,0,Math.PI/2);

// === TAPIS CENTRAL ===
const tapis = new THREE.Mesh(
  new THREE.PlaneGeometry(6,24),
  new THREE.MeshStandardMaterial({color:0x7CFC00})
);
tapis.rotation.x = -Math.PI/2;
tapis.position.y = 0.05;
scene.add(tapis);

// === BASES (4 Ã  gauche, 4 Ã  droite) ===
const baseGeo = new THREE.BoxGeometry(4,0.5,3);
const baseMat = new THREE.MeshStandardMaterial({color:0xdddddd});
for(let i=0;i<4;i++){
  const left = new THREE.Mesh(baseGeo,baseMat);
  left.position.set(-15,0.25,-12+i*8);
  scene.add(left);
  const right = new THREE.Mesh(baseGeo,baseMat);
  right.position.set(15,0.25,-12+i*8);
  scene.add(right);
}

// === JOUEUR ===
const player = new THREE.Mesh(
  new THREE.BoxGeometry(1,2,1),
  new THREE.MeshStandardMaterial({color:0x0000ff})
);
player.position.set(0,1,10);
scene.add(player);

const keys={};
document.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);
const speed=0.25;

// === PNJ CLASS ===
class PNJ {
  constructor(name, rarity, price){
    this.name=name; this.rarity=rarity; this.price=price;
    this.mesh=new THREE.Mesh(
      new THREE.BoxGeometry(1,2,1),
      new THREE.MeshStandardMaterial({color:PNJ.getColor(rarity)})
    );
    this.mesh.position.set(0,1,-10);
    scene.add(this.mesh);

    // label
    const canvas=document.createElement('canvas');
    canvas.width=256; canvas.height=64;
    const ctx=canvas.getContext('2d');
    ctx.fillStyle='white'; ctx.font='16px Arial';
    ctx.fillText(`${name}`,10,20);
    ctx.fillText(`${rarity} | ${price}ðŸ’µ`,10,45);
    const texture=new THREE.CanvasTexture(canvas);
    const sprite=new THREE.Sprite(new THREE.SpriteMaterial({map:texture,transparent:true}));
    sprite.scale.set(4,1,1);
    sprite.position.set(0,3,-10);
    scene.add(sprite);
    this.label=sprite;
  }
  move(speed){
    this.mesh.position.z+=speed;
    this.label.position.z+=speed;
  }
  static getColor(r){
    switch(r){
      case'Commun':return 0xaaaaaa;
      case'Rare':return 0x00ff00;
      case'Epic':return 0x0000ff;
      case'LÃ©gendaire':return 0xffd700;
      default:return 0xffffff;
    }
  }
}

// === PNJ DISPONIBLES ===
const availablePNJ=[
  {name:'Petit Titan',rarity:'Commun',price:50},
  {name:'Souris Malicieuse',rarity:'Commun',price:80},
  {name:'Grand HÃ©ron',rarity:'Rare',price:120},
  {name:'Petit Dragon',rarity:'Epic',price:500}
];

const pnjList=[];
let money=100;
const moneyDiv=document.getElementById('money');
function updateMoney(){moneyDiv.textContent=`ðŸ’µ ${Math.floor(money)}`;}
updateMoney();

function showMessage(t){
  const m=document.getElementById('message');
  m.textContent=t; m.style.display='block';
  setTimeout(()=>m.style.display='none',1500);
}

// === SPAWN PNJ ===
function spawnPNJ(data){
  if(pnjList.length>=12){showMessage("Plus de place, vends-en un !");return;}
  if(money<data.price){showMessage("Pas assez d'argent !");return;}
  money-=data.price; updateMoney();
  const p=new PNJ(data.name,data.rarity,data.price);
  pnjList.push(p);
}

// === BOUTONS D'ACHAT ===
availablePNJ.forEach((p,i)=>{
  document.getElementById('buy'+i).onclick=()=>spawnPNJ(p);
});

// === GAIN D'ARGENT AUTOMATIQUE ===
setInterval(()=>{money+=2;updateMoney();},2000);

// === ANIMATION ===
function animate(){
  requestAnimationFrame(animate);
  if(keys['w']||keys['arrowup'])player.position.z-=speed;
  if(keys['s']||keys['arrowdown'])player.position.z+=speed;
  if(keys['a']||keys['arrowleft'])player.position.x-=speed;
  if(keys['d']||keys['arrowright'])player.position.x+=speed;
  camera.position.x=player.position.x+8;
  camera.position.y=player.position.y+8;
  camera.position.z=player.position.z+12;
  camera.lookAt(player.position);

  // PNJ move
  for(let i=pnjList.length-1;i>=0;i--){
    const p=pnjList[i]; p.move(0.02);
    if(p.mesh.position.z>12){
      scene.remove(p.mesh); scene.remove(p.label); pnjList.splice(i,1);
    }
  }

  renderer.render(scene,camera);
}
animate();

window.addEventListener('resize',()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
