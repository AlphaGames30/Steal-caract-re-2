<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Steal-a-Thing 3D Bases</title>
 <style>
  html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    overflow: hidden; /* empÃªche les barres de dÃ©filement */
  }

  canvas {
    width: 100%;
    height: 100%;
    display: block;
  }
</style>
</head>
<body>
<div id="money">ðŸ’µ 100</div>
<div id="message">Plus de place, vends-en un !</div>
<canvas id="renderCanvas"></canvas>

<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
<script>
const canvas = document.getElementById("renderCanvas");
const engine = new BABYLON.Engine(canvas,true);
const scene = new BABYLON.Scene(engine);
scene.clearColor = new BABYLON.Color3(0.6,0.8,1);

// --- CamÃ©ra joueur ---
const camera = new BABYLON.ArcRotateCamera("cam",-Math.PI/2,Math.PI/3,120,new BABYLON.Vector3(0,0,0),scene);
camera.attachControl(canvas,true);

// --- LumiÃ¨res ---
new BABYLON.HemisphericLight("hemi",new BABYLON.Vector3(0,1,0),scene);
const dirLight = new BABYLON.DirectionalLight("dir",new BABYLON.Vector3(0,-1,1),scene);
dirLight.intensity = 0.7;

// --- Sol et murs ---
const ground = BABYLON.MeshBuilder.CreateGround("ground",{width:90,height:100},scene);
ground.material = new BABYLON.StandardMaterial("groundMat",scene);
ground.material.diffuseColor = new BABYLON.Color3(0,0.6,0);

// Murs autour
function createWall(x,z,width,height,depth){
  const wall = BABYLON.MeshBuilder.CreateBox("wall",{width,height,depth},scene);
  wall.position.set(x,height/2,z);
  wall.material = new BABYLON.StandardMaterial("wallMat",scene);
  wall.material.diffuseColor = new BABYLON.Color3(0.5,0.5,0.5);
  return wall;
}
// Murs : nord, sud, est, ouest
createWall(0,-50,90,10,1);
createWall(0,50,90,10,1);
createWall(-45,0,1,10,100);
createWall(45,0,1,10,100);

// --- Portails nord/sud ---
function createPortal(x,z,name){
  const portal = BABYLON.MeshBuilder.CreateBox(name,{width:6,height:6,depth:1},scene);
  portal.position.set(x,3,z);
  const mat = new BABYLON.StandardMaterial(name+"Mat",scene);
  mat.diffuseColor = (name=="north")? new BABYLON.Color3(0,0,1) : new BABYLON.Color3(1,0,0);
  portal.material = mat;
  return portal;
}
const northPortal = createPortal(0,-48,"north");
const southPortal = createPortal(0,48,"south");

// --- Bases (4 gauche + 4 droite) ---
const bases = [];
function createBase(x,z){
  const base = BABYLON.MeshBuilder.CreateBox("base",{width:12,height:6,depth:12},scene);
  base.position.set(x,3,z);
  const mat = new BABYLON.StandardMaterial("baseMat",scene);
  mat.diffuseColor = new BABYLON.Color3(0.7,0.7,0.7);
  base.material = mat;
  base.slots = [null,null,null]; // 3 slots PNJ
  bases.push(base);
  return base;
}
for(let i=0;i<4;i++) createBase(-30,i*25-37.5);
for(let i=0;i<4;i++) createBase(30,i*25-37.5);

// --- Joueur ---
const player = BABYLON.MeshBuilder.CreateBox("player",{width:1,height:2,depth:1},scene);
player.position.set(0,1,45);
player.material = new BABYLON.StandardMaterial("playerMat",scene);
player.material.diffuseColor = new BABYLON.Color3(0,0,1);

// --- Argent ---
let money = 100;
const moneyDiv = document.getElementById("money");
function updateMoney(){ moneyDiv.textContent = `ðŸ’µ ${Math.floor(money)}`; }
updateMoney();

// --- Message ---
const messageDiv = document.getElementById("message");
function showMessage(text){
  messageDiv.textContent = text;
  messageDiv.style.display="block";
  setTimeout(()=>{messageDiv.style.display="none";},1500);
}

// --- Classe PNJ ---
class PNJ{
  constructor(data,x,z){
    this.data = data;
    const size = data.name==="Petit Dragon"?1.5:1;
    this.mesh = BABYLON.MeshBuilder.CreateBox(data.name,{width:size,height:size*2,depth:size},scene);
    this.mesh.position.set(x,size,z);
    const mat = new BABYLON.StandardMaterial(data.name+"Mat",scene);
    mat.diffuseColor = PNJ.getColor(data.rarity);
    this.mesh.material = mat;

    // Label GUI
    const advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");
    const label = new BABYLON.GUI.Rectangle();
    label.width="90px"; label.height="45px"; label.background="transparent";
    const textBlock = new BABYLON.GUI.TextBlock();
    textBlock.text = `${data.name}\n${data.rarity}\n${data.gain}/s\n${data.price}ðŸ’µ`;
    textBlock.color="white"; textBlock.fontSize=12; textBlock.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
    label.addControl(textBlock);
    advancedTexture.addControl(label);
    label.linkWithMesh(this.mesh);
    label.linkOffsetY=-40;

    // Achat au clic
    this.mesh.actionManager = new BABYLON.ActionManager(scene);
    this.mesh.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,()=>{
      buyPNJ(this);
    }));
  }

  static getColor(rarity){
    switch(rarity){
      case "Commun": return new BABYLON.Color3(0.7,0.7,0.7);
      case "Rare": return new BABYLON.Color3(0,1,0);
      case "Epic": return new BABYLON.Color3(0,0,1);
      case "LÃ©gendaire": return new BABYLON.Color3(1,0.84,0);
      default: return new BABYLON.Color3(1,1,1);
    }
  }
}

// --- PNJ disponibles ---
const availablePNJ = [
  {name:"Petit Titan", rarity:"Commun", price:50, gain:5},
  {name:"Souris Malicieuse", rarity:"Commun", price:80, gain:10},
  {name:"Grand HÃ©ron", rarity:"Rare", price:120, gain:25},
  {name:"Petit Dragon", rarity:"Epic", price:500, gain:50}
];

const pnjList=[];

// --- Acheter PNJ ---
function buyPNJ(pnj){
  if(money>=pnj.data.price){
    const base = bases.find(b=>b.slots.includes(null));
    if(!base){ showMessage("Plus de place, vends-en un !"); return; }
    money -= pnj.data.price;
    updateMoney();
    const index = base.slots.indexOf(null);
    base.slots[index]=pnj;
    pnj.mesh.position.x = base.position.x;
    pnj.mesh.position.z = base.position.z + (index-1)*3;
  } else showMessage("Pas assez d'argent !");
}

// --- Spawn PNJ automatique depuis portail nord ---
setInterval(()=>{
  const data = availablePNJ[Math.floor(Math.random()*availablePNJ.length)];
  const pnj = new PNJ(data,0,-48);
  pnjList.push(pnj);
},3000);

// --- DÃ©placement PNJ vers portail sud ---
scene.onBeforeRenderObservable.add(()=>{
  for(let i=pnjList.length-1;i>=0;i--){
    const p = pnjList[i];
    if(!bases.some(b=>b.slots.includes(p))){
      p.mesh.position.z += 0.15;
      if(p.mesh.position.z>48){ p.mesh.dispose(); pnjList.splice(i,1); }
    }
  }
});

// --- ContrÃ´le joueur ---
const inputMap={};
scene.actionManager = new BABYLON.ActionManager(scene);
scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger,(evt)=>{inputMap[evt.sourceEvent.key]=true;}));
scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger,(evt)=>{inputMap[evt.sourceEvent.key]=false;}));

scene.onBeforeRenderObservable.add(()=>{
  if(inputMap["w"]) player.position.z -= 0.3;
  if(inputMap["s"]) player.position.z += 0.3;
  if(inputMap["a"]) player.position.x -= 0.3;
  if(inputMap["d"]) player.position.x += 0.3;
});

 <script>
// --- Renderer ---
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// --- ScÃ¨ne ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xa0a0a0);

// --- CamÃ©ra ---
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);

// --- LumiÃ¨res ---
const light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(10,20,10);
scene.add(light);

const ambient = new THREE.AmbientLight(0xffffff, 0.5);
scene.add(ambient);

// --- Sol ---
const solGeo = new THREE.PlaneGeometry(100,100);
const solMat = new THREE.MeshStandardMaterial({color:0x228B22});
const sol = new THREE.Mesh(solGeo, solMat);
sol.rotation.x = -Math.PI/2;
scene.add(sol);

// --- Personnage joueur ---
const playerGeo = new THREE.BoxGeometry(1,2,1);
const playerMat = new THREE.MeshStandardMaterial({color:0x0000ff});
const player = new THREE.Mesh(playerGeo, playerMat);
player.position.set(0,1,0);
scene.add(player);

// --- ContrÃ´les clavier ---
const keys = {};
document.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);
const speed = 0.2;

// --- Animation ---
function animate() {
  requestAnimationFrame(animate);

  // DÃ©placement joueur
  if(keys['a'] || keys['arrowup']) player.position.z -= speed;
  if(keys['z'] || keys['arrowdown']) player.position.z += speed;
  if(keys['e'] || keys['arrowleft']) player.position.x -= speed;
  if(keys['r'] || keys['arrowright']) player.position.x += speed;

  // CamÃ©ra derriÃ¨re le joueur
  camera.position.x = player.position.x + 5;
  camera.position.y = player.position.y + 5;
  camera.position.z = player.position.z + 10;
  camera.lookAt(player.position);

  renderer.render(scene, camera);
}

animate();

// --- Resize ---
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>


// --- Render Loop ---
engine.runRenderLoop(()=>scene.render());
window.addEventListener("resize",()=>engine.resize());
</script>
</body>
</html>
